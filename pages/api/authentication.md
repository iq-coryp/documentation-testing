---
title:  Authentication
permalink: /api/authentication/
tags: []
keywords: 
audience: 
last_updated: 03-11-2015
summary: 
---

{% include linkrefs.html %}

## Overview 

iQmetrix APIs are protected by {{OAuth2_Glossary}}.

In order to make authorized requests to iQmetrix APIs, your application must first obtain an {{AccessToken_Glossary}}.

## Endpoints

* Sandbox: https://accountsdemo.iqmetrix.net/v1
* Production: https://accounts.iqmetrix.net/v1

## Note

The code samples below use the following `OAuth2TokenResponse` object,

```csharp
public class OAuth2TokenResponse
{
    public string access_token { get; set; }
    public string expires_in { get; set; }
    public string refresh_token { get; set; }
}
```

## Obtaining an Access Token

{{note}}
Each time this request is made, a <b>new</b> access token is created and returned
{{end}}

{{tip}}
As long as an access token is not expired, it can be used to authorize requests to <b>ANY</b> iQmetrix API. 
{{end}}

#### Request

    POST /oauth2/token
    grant_type={grant_type}&
    username={username}&
    password={password}&
    client_id={client_id}&
    client_secret={client_secret}

#### Headers

* `Content-Type: application/x-www-form-urlencoded`

#### Request Parameters

*  `grant_type` (**Required**) - The value must be `password`
*  `username` (**Required**) - The username provided to iQmetrix, usually an email address
*  `password` (**Required**) - The password, provided when an account is created
*  `client_id` (**Required**) The client ID provided by iQmetrix
*  `client_secret` (**Required**) - The client secret

###### Example

    POST /oauth2/token
    Content-Type: application/x-www-form-urlencoded
    grant_type=password&
    username=email@example.com&
    password=examplepassword&
    client_id=exampleclient&
    client_secret=examplesecret

###### Code Sample (C#)

```c#
using RestSharp;
using RestSharp.Contrib;

public static OAuth2TokenResponse ObtainingAnAccessToken()
{
    var client = new RestClient("https://accountsdemo.iqmetrix.net/v1/oauth2");
    var request =
        new RestRequest("token", Method.POST)
            .AddParameter("grant_type", "password")
            .AddParameter("username", "email@example.com")
            .AddParameter("password", "examplepassword")
            .AddParameter("client_id", "exampleclient")
            .AddParameter("client_secret", "examplesecret");

    request.AddHeader("Content-Type", "application/x-www-form-urlencoded");

    var response = client.Execute<OAuth2TokenResponse>(request);

    return response.Data;
}
```

#### Response

* `access_token` - The access token issued by the authorization server
* `expires_in` - Seconds remaining until the access token expires, **12 hours** or less if revoked
* `refresh_token` - The refresh token generated by the authorization server, expires after **7 days**

###### Example

    HTTP 200 Content-Type: application/json
    {
        "access_token": "3dae10c05e894011b5b3ae15972ffbf4",
        "expires_in": 43199,
        "refresh_token": "f8bk56n40f7gi34j49g7bh4n430gf874h" 
    }

## Refreshing an Access Token 

Instead of always using credentials, a client application may use the refresh token to obtain a new access token.

{{important}}
Once a refresh token has been exchanged, the access token it was provided with is revoked
{{end}}
{{note}}
The client credentials must be the same as those used in the request to acquire the provided refresh token
{{end}}

#### Request

    POST /oauth2/token
    grant_type={grant_type}&
    client_id={client_id}&
    client_secret={client_secret}&
    refresh_token={RefreshToken}

#### Headers

* `Content-Type: application/x-www-form-urlencoded`

#### Request Parameters

* `grant_type` (**Required**) - The value must be `refresh_token`
* `client_id` (**Required**) The client ID provided by iQmetrix
* `client_secret` (**Required**) - The client secret, should not be shared
* `refresh_token` (**Required**) - The refresh token we are exchanging 

###### Example

    POST /oauth2/token 
    Content-Type: application/x-www-form-urlencoded
    grant_type=refresh_token& 
    client_id=exampleclient& 
    client_secret=examplesecret& 
    refresh_token=f8bk56n40f7gi34j49g7bh4n430gf874h

###### Code Sample (C#)

```c#
using RestSharp;
using RestSharp.Contrib;

public static OAuth2TokenResponse RefreshingAnAccessToken(string refreshToken)
{

    var client = new RestClient("https://accountsdemo.iqmetrix.net/v1/oauth2");
    var request =
        new RestRequest("token", Method.POST)
            .AddParameter("refresh_token", refreshToken)
            .AddParameter("grant_type", "refresh_token")
            .AddParameter("client_id", "exampleclient")
            .AddParameter("client_secret", "examplesecret");

    request.AddHeader("Content-Type", "application/x-www-form-urlencoded");

    var response = client.Execute<OAuth2TokenResponse>(request);

    return response.Data;
}
```

#### Response

* `access_token` - The access token issued by the authorization server
* `expires_in` - Seconds remaining until the access token expires, default is **12 hours**
* `refresh_token` - Another refresh token generated by the authorization server, expires after **7 days**

###### Example

    HTTP 200 Content-Type: application/json 
    { 
        "access_token": "3dae10c05e894011b5b3ae15972ffbf4", 
        "expires_in": 43199, 
        "refresh_token": "clbv67g93j5b5040g74o30458fjdfm4df78" 
    }

## Errors

| HTTP Status Code | Description | How to Resolve |
|:-----------------|:------------|:---------------|
| `HTTP 400` | `unsupported_grant_type` | Ensure grant_type is set to appropriately |
| `HTTP 400` | `invalid_client` | Ensure client_id and client_secret are correct |
| `HTTP 400` | `invalid_grant` | Ensure client credentials are correct. For a refresh token, ensure credentials are the same as those used to acquire the original access token  |
